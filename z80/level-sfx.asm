write './bin/level-sfx.bin'	;WinAPE build target
read	'./Plugin-constants.asm'
	
; Boingy, boingy - player jumped
sfx_boing:
	call	sfx_mute_psg
	ld	a, &0E
	ld	(sfx_counter), a

	ld 	a,%10010100
	ld 	(psg),a
	
	ld 	a,%10000010
	ld 	(psg),a

	ld 	a,%00001111
	ld 	(psg),a

	ld 	hl,sfx_boing_att+sfx_coredriver_size
	ld 	(sfx_callback),hl
	jp	sfx_callback_return
sfx_boing_att:
	ld	a, (sfx_counter)
	or	a
	jp	Z,sfx_nop_trap

	and	%00001111
	or	%10000000
	ld	(psg),a
	and	%01111111
	ld	(psg),a
	jp	sfx_callback_return

sfx_pewpew:
	call	sfx_mute_psg
	ld	a, 12
	ld	(sfx_counter), a

	ld 	a,%10010000
	ld 	(psg),a
	
	ld 	a,%10000010
	ld 	(psg),a

	ld 	a,%00001111
	ld 	(psg),a

	ld 	a,%11110000
	ld 	(psg),a

	ld 	a,%11100110
	ld 	(psg),a

	ld 	hl,sfx_pewpew_att+sfx_coredriver_size
	ld 	(sfx_callback),hl
	jp	sfx_callback_return
sfx_pewpew_att:
	ld	a,(sfx_counter)
	or	a
	jp	Z,sfx_nop_trap

	neg
	add	12
	and	%00001111
	or	%10000000
	ld	(psg),a
	and	%01111111
	ld	(psg),a

	ld	a,(sfx_counter)
	and	%00001111
	or	%11110000
	ld	(psg),a
	and	%00001111
	xor	%00001010
	or	%11100000
	ld	(psg),a
	jp	sfx_callback_return

sfx_slash:
	call	sfx_mute_psg
	ld	a, 10
	ld	(sfx_counter), a

	ld	a,%11110011
	ld	(psg),a
	ld	a,%11100101
	ld	(psg),a
	ld	a,%10110101
	ld	(psg),a
	ld	a,%10100001
	ld	(psg),a
	ld	a,%00100000
	ld	(psg),a

	ld 	hl,sfx_slash_att+sfx_coredriver_size
	ld 	(sfx_callback),hl
	jp	sfx_callback_return
sfx_smack:
	call	sfx_mute_psg
	ld	a, 10
	ld	(sfx_counter), a

	ld	a,%11111011
	ld	(psg),a
	ld	a,%11100010
	ld	(psg),a
	ld	a,%10110101
	ld	(psg),a
	ld	a,%10100111
	ld	(psg),a
	ld	a,%00101010
	ld	(psg),a

	ld 	hl,sfx_slash_att+sfx_coredriver_size
	ld 	(sfx_callback),hl
	jp	sfx_callback_return
sfx_slash_att:
	ld	a,(sfx_counter)
	or	a
	jp	Z,sfx_nop_trap

	neg
	add	10
	and	%00001111
	or	%11110000
	ld	(psg),a
	and	%10111111
	ld	(psg),a

	jp	sfx_callback_return

sfx_collection:
	call	sfx_mute_psg
	ld	a, 10
	ld	(sfx_counter), a

	ld	a,%10110010
	ld	(psg),a
	ld	a,%10011010
	ld	(psg),a

	ld	a,%10100001
	ld	(psg),a
	ld	a,%00100100
	ld	(psg),a

	ld	a,%10001011
	ld	(psg),a
	ld	a,%00000010
	ld	(psg),a

	ld 	hl,sfx_collection_att+sfx_coredriver_size
	ld 	(sfx_callback),hl
	jp	sfx_callback_return

sfx_collection_att:
	ld	a,(sfx_counter)
	or	a
	jp	Z,sfx_nop_trap

	neg
	add	10
	and	%00001111
	or	%10010000
	ld	(psg),a
	or	%10110000
	ld	(psg),a

	and	%10001111
	ld	(psg),a
	ld	a,%00000000
	ld	(psg),a 
	jp	sfx_callback_return

sfx_player_dead:
	trigger_melody melody_death+sfx_coredriver_size, 5

sfx_player_hurt:
	trigger_melody melody_player_damaged+sfx_coredriver_size, 2

sfx_fanfare:
	trigger_melody melody_happy_jingle+sfx_coredriver_size, 3

sfx_spawn:
	trigger_melody melody_spawn+sfx_coredriver_size, 2

sfx_projectile:
	trigger_melody melody_projectile+sfx_coredriver_size, 2
;As a test, PSG melodies have the following format:
; For each note:
; 1 byte for the delay
; 4 bytes for channel volumes
; 6 bytes for tone channel freq
; 1 byte for noise channel freq
; a delay of 0 means the melody is over
melody_death:
;TEMPO 300
 db  0,1,%10010000,%10110000,%11011111,%11111111
 db    %10000011,%00010101,%10101001,%00001010,%11001001,%00000101,%11101001
 db  1,1,%10010000,%10110000,%11011111,%11111111
 db    %10000111,%00010110,%10100011,%00001011,%11001001,%00000101,%11101001
 db  1,1,%10010000,%10110000,%11011111,%11111111
 db    %10000011,%00010101,%10101001,%00001010,%11001001,%00000101,%11101001
 db  1,1,%10010000,%10110000,%11011111,%11111111
 db    %10000111,%00010110,%10100011,%00001011,%11001001,%00000101,%11101001
 db  1,1,%10010000,%10110000,%11011111,%11111111
 db    %10000011,%00010101,%10101001,%00001010,%11001001,%00000101,%11101001
 db  1,1,%10010000,%10111111,%11011111,%11111111
 db    %10000101,%00011100,%10101001,%00000101,%11001001,%00000101,%11101001
 db  1,1,%10010000,%10111111,%11011111,%11111111
 db    %10001010,%00100011,%10101001,%00000101,%11001001,%00000101,%11101001
 db  1,1,%10010000,%10111111,%11011111,%11111111
 db    %10001100,%00100101,%10101001,%00000101,%11001001,%00000101,%11101001
 db  1,1,%10010000,%10111111,%11011111,%11111111
 db    %10000110,%00101010,%10101001,%00000101,%11001001,%00000101,%11101001
 db  8,0,%10011111,%10111111,%11011111,%11111111
 db    %10000110,%00101010,%10101001,%00000101,%11001001,%00000101,%11101001
 db  0 ;END


melody_player_damaged:
;TEMPO 400
 db  1,1,%10011111,%10110000,%11010000,%11110000
 db    %10001001,%00000101,%10101010,%00111000,%11001101,%01010100,%11100011
 db  1,1,%10011111,%10110000,%11010000,%11110000
 db    %10001001,%00000101,%10101111,%00111011,%11001110,%01011001,%11101100
 db  1,1,%10011111,%10110000,%11010000,%11110000
 db    %10001001,%00000101,%10101111,%00111011,%11001110,%01011001,%11101100
 db  2,0,%10011111,%10111111,%11011111,%11111111
 db    %10000011,%00010101,%10101001,%00000101,%11001001,%00000101,%11101001
 db  0 ;END

melody_happy_jingle:
;TEMPO 400
 db  0,1,%10010000,%10110000,%11011111,%11111111
 db    %10001110,%00010010,%10101100,%00100101,%11001001,%00000101,%11101001
 db  1,1,%10010000,%10110000,%11011111,%11111111
 db    %10001101,%00010001,%10101010,%00100011,%11001001,%00000101,%11101001
 db  1,1,%10010000,%10110000,%11011111,%11111111
 db    %10001110,%00001111,%10101100,%00011111,%11001001,%00000101,%11101001
 db  1,1,%10010000,%10110000,%11011111,%11111111
 db    %10000010,%00001110,%10100101,%00011100,%11001001,%00000101,%11101001
 db  1,1,%10010000,%10110000,%11011111,%11111111
 db    %10000101,%00001101,%10101011,%00011010,%11001001,%00000101,%11101001
 db  2,1,%10010000,%10110000,%11011111,%11111111
 db    %10000101,%00001101,%10101011,%00011010,%11001001,%00000101,%11101001
 db  2,1,%10010000,%10110000,%11011111,%11111111
 db    %10001110,%00001011,%10101100,%00010111,%11001001,%00000101,%11101001
 db  2,1,%10010000,%10110000,%11011111,%11111111
 db    %10001001,%00001010,%10100011,%00010101,%11001001,%00000101,%11101001
 db  2,1,%10010000,%10110000,%11010000,%11111111
 db    %10001111,%00000111,%10101110,%00001111,%11001001,%00001010,%11101001
 db  2,1,%10010000,%10110000,%11010000,%11111111
 db    %10001110,%00001000,%10101101,%00010001,%11000010,%00001110,%11101001
 db  2,1,%10010000,%10110000,%11011111,%11111111
 db    %10001001,%00001010,%10100011,%00010101,%11001001,%00000101,%11101001
 db  2,1,%10010000,%10110000,%11010000,%11111111
 db    %10001111,%00000111,%10101110,%00001111,%11001110,%00001011,%11101001
 db  2,1,%10010000,%10110000,%11010000,%11111111
 db    %10001110,%00001000,%10101101,%00010001,%11000010,%00001110,%11101001
 db  2,1,%10010000,%10110000,%11011111,%11111111
 db    %10001001,%00001010,%10100011,%00010101,%11001001,%00000101,%11101001
 db  2,1,%10010000,%10110000,%11010000,%11111111
 db    %10001111,%00000111,%10101110,%00001111,%11001001,%00001010,%11101001
 db  2,1,%10010000,%10110000,%11011111,%11111111
 db    %10001110,%00001000,%10101101,%00010001,%11001001,%00000101,%11101001
 db  2,4,%10010000,%10110000,%11010000,%11111111
 db    %10001010,%00000110,%10100101,%00001101,%11001110,%00001000,%11101001
 db  4,0,%10011111,%10111111,%11011111,%11111111
 db    %10001010,%00000110,%10100101,%00001101,%11001110,%00001000,%11101001
 db  0 ;END


melody_spawn:
;TEMPO 400
 db  0,1,%10010000,%10111111,%11011111,%11111111
 db    %10000010,%00001110,%10101001,%00000101,%11001001,%00000101,%11101001
 db  1,1,%10010000,%10111111,%11011111,%11111111
 db    %10000101,%00001101,%10101001,%00000101,%11001001,%00000101,%11101001
 db  1,1,%10010000,%10111000,%11011111,%11111111
 db    %10001001,%00001010,%10101111,%00000111,%11001001,%00000101,%11101001
 db  1,1,%10010000,%10111000,%11011111,%11111111
 db    %10001110,%00001000,%10101010,%00000110,%11001001,%00000101,%11101001
 db  5,0,%10011111,%10111111,%11011111,%11111111
 db    %10001110,%00001000,%10101010,%00000110,%11001001,%00000101,%11101001
 db  0 ;END

melody_projectile:
;TEMPO 400
 db  0,1,%10011111,%10111111,%11011111,%11110000
 db    %10001001,%00000101,%10101001,%00000101,%11001001,%00000101,%11101100
 db  1,1,%10011111,%10111111,%11011111,%11110011
 db    %10001001,%00000101,%10101001,%00000101,%11001001,%00000101,%11100111
 db  1,1,%10011111,%10111111,%11011111,%11111000
 db    %10001001,%00000101,%10101001,%00000101,%11001001,%00000101,%11100011
 db  1,1,%10011111,%10111111,%11011111,%11111100
 db    %10001001,%00000101,%10101001,%00000101,%11001001,%00000101,%11100000
 db  1,1,%10011111,%10111111,%11011111,%11111111
 db    %10001001,%00000101,%10101001,%00000101,%11001001,%00000101,%11101110
 db  4,0,%10011111,%10111111,%11011111,%11111111
 db    %10001001,%00000101,%10101001,%00000101,%11001001,%00000101,%11101110
 db  0 ;END
